{% extends 'MAIN/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/store_item.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
{% endblock %}

{% block background %}
    {% include 'MAIN/base_background_starry.html' %}
{% endblock %}

{% block content %}
<div class="product-container">
    <!-- Back link -->
    <div class="product-navigation">
        <a href="{% url 'STORE:store' %}" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Store
        </a>
    </div>
    
    <!-- Split layout for product -->
    <div class="product-split">
        <!-- Left side: Gallery -->
        <div class="product-gallery-side">
            <div class="product-featured-image">
                <img src="{% static 'images/1.jpg' %}" 
                     alt="Basic Package" class="featured-image" id="featuredImage">
            </div>
            
            <div class="gallery-thumbnails">
                <!-- Thumbnails -->
                <div class="thumbnail active" data-image="{% static 'images/1.jpg' %}">
                    <img src="{% static 'images/1.jpg' %}" alt="Main Package View">
                </div>
                <div class="thumbnail" data-image="{% static 'images/2.jpg' %}">
                    <img src="{% static 'images/2.jpg' %}" alt="Gallery Image 2">
                </div>
                <div class="thumbnail" data-image="{% static 'images/3.jpg' %}">
                    <img src="{% static 'images/3.jpg' %}" alt="Gallery Image 3">
                </div>
                <div class="thumbnail" data-image="{% static 'images/4.jpg' %}">
                    <img src="{% static 'images/4.jpg' %}" alt="Gallery Image 4">
                </div>
                <div class="thumbnail" data-image="{% static 'images/5.jpg' %}">
                    <img src="{% static 'images/5.jpg' %}" alt="Gallery Image 5">
                </div>
            </div>
        </div>
        
        <!-- Right side: Product info -->
        <div class="product-info-side">
            <div class="product-card">
                <h1 class="product-title">BASIC PACKAGE
                    <div class="product-status-container">
                        <div class="product-status {% if product.is_active %}active{% else %}inactive{% endif %}">
                            {% if product.is_active %}ACTIVE{% else %}INACTIVE{% endif %}
                        </div>
                        
                        {% if user.is_staff %}
                        <div class="admin-toggle">
                            <label class="toggle" data-product-id="{{ product.id }}">
                                <input type="checkbox" class="toggle-checkbox" {% if product.is_active %}checked{% endif %}>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        {% endif %}
                    </div>
                </h1>
                <div class="product-description">
                    <h2>DESCRIPTION</h2>
                    <p>Start your streaming journey with our Basic Package. This includes a custom overlay with essential elements to make your stream look professional.</p>
                </div>
                
                <div class="product-features">
                    <h2>FEATURES:</h2>
                    <ul class="features-list">
                        <li>
                            <i class="fas fa-check-circle"></i>
                            Basic stream overlay
                        </li>
                        <li>
                            <i class="fas fa-check-circle"></i>
                            Simple alerts setup
                        </li>
                        <li>
                            <i class="fas fa-check-circle"></i>
                            Single scene design
                        </li>
                        <li>
                            <i class="fas fa-check-circle"></i>
                            1 minor revision
                        </li>
                    </ul>
                </div>
                
                <div class="product-purchase">
                    <div class="price-section">
                        <div class="price-label">Price:</div>
                        <div class="price-value">$25.00</div>
                    </div>
                    <a href="{% url 'contact' %}?subject=Purchase%20Basic%20Package" class="purchase-btn">PURCHASE NOW</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Toggle Script -->
    {% if user.is_staff %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Move all admin-toggle elements outside of their parent anchor tags
            document.querySelectorAll('.admin-toggle').forEach(toggle => {
                const parent = toggle.closest('.window-header');
                const anchor = toggle.closest('a');
                if (parent && anchor) {
                    // Extract the toggle from anchor and append to window-header
                    anchor.removeChild(toggle);
                    parent.appendChild(toggle);
                }
            });
            
            // Now set up the toggle event listeners
            document.querySelectorAll('.toggle').forEach(toggle => {
                toggle.style.cursor = 'pointer';
                
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const checkbox = this.querySelector('.toggle-checkbox');
                    const productId = this.dataset.productId;
                    const newState = !checkbox.checked;
                    
                    // Simple URL construction
                    const url = newState ? 
                        '/STORE/force-active/' + productId + '/' : 
                        '/STORE/force-inactive/' + productId + '/';
                    
                    console.log("Calling URL:", url);
                    
                    // Make the request and reload the page
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            console.log('Response:', data);
                            window.location.reload();
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                });
            });
        });
    </script>
    {% endif %}
{% endblock %}