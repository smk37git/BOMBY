{% extends 'MAIN/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/bomby_page.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
{% endblock %}

{% block background %}
    {% include 'MAIN/base_background.html' %}
{% endblock %}

{% block content %}
    <div class="project-container">
        <!-- Horizontal Split Hero Section -->
        <section class="hero-split">
            <!-- Left Side - Hero Content -->
            <div class="hero-content-side">
                <h1 class="project-title">BOMBY WEBSITE PROJECT</h1>
                <p class="project-author">By Sebastian Main</p>
                <p class="project-brief">A modern web development project showcasing frontend and backend skills with a focus on user experience and performance optimization.
                    Includes a full E-Commerce platform with user authentication, product listings, and checkout functionality.
                </p>
                
                <div class="hero-cta">
                    <a href="{% url 'PORTFOLIO:portfolio' %}" class="hero-button">
                        <i class="fas fa-arrow-left"></i> Back to Portfolio
                    </a>
                    <a href="{% url 'MAIN:home' %}" target="_blank" class="hero-button primary">View Live</a>
                    <a href="https://github.com/smk37git/BOMBY" target="_blank" class="hero-button">GitHub Repo</a>
                </div>
            </div>
            
            <!-- Right Side - Gallery -->
            <div class="hero-gallery-side">
                <div class="project-featured-image">
                    <img src="{% static 'images/BOMBY.png' %}" alt="Project Name" class="featured-image" id="featuredImage">
                </div>
                
                <div class="gallery-thumbnails">
                    <div class="thumbnail active" data-image="{% static 'images/BOMBY.png' %}">
                        <img src="{% static 'images/BOMBY.png' %}" alt="Main Project Image">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/portfolio_bomby_1.jpg' %}">
                        <img src="{% static 'images/portfolio_bomby_1.jpg' %}" alt="Gallery Image 1">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/portfolio_bomby_2.jpg' %}">
                        <img src="{% static 'images/portfolio_bomby_2.jpg' %}" alt="Gallery Image 2">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/portfolio_bomby_3.jpg' %}">
                        <img src="{% static 'images/portfolio_bomby_3.jpg' %}" alt="Gallery Image 3">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/portfolio_bomby_4.jpg' %}">
                        <img src="{% static 'images/portfolio_bomby_4.jpg' %}" alt="Gallery Image 4">
                    </div>
                </div>
            </div>
        </section>
        
        <!-- GitHub Commit Display Container -->
        <div class="github-commit-container">
            <!-- This will be populated by scripts below -->
            <div class="github-header">
                <a href="https://github.com/smk37git/BOMBY" target="_blank" class="github-logo">
                    <i class="fab fa-github"></i>
                    <span>Loading commit data...</span>
                </a>
            </div>
            <div class="github-commit" style="padding: 1.5rem; text-align: center;">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: rgba(255, 255, 255, 0.5);"></i>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="project-content">
            <!-- Overview Section -->
            <section class="content-section" id="overview">
                <div class="section-header">
                    <h2 class="section-title" style="margin-top: 100px;">Project Overview</h2>
                    <p class="section-subtitle">A detailed look at the purpose and approach of this project</p>
                </div>
                
                <div class="project-info-grid">
                    <div class="info-card">
                        <h3 class="info-card-title">The Project</h3>
                        <div class="info-card-content">
                            <p>
                                I decided to create BOMBY due to the increasingly frustrating experience of being a
                                freelancer on other popular websites like Fiverr or UpWork to name a few. I wanted to make a platform
                                that was more user-friendly, and more focused on the user experiences of both the client
                                and the seller. 
                                <br></br>
                                
                                I figured it would be a good idea to blend that platform with my portfolio.
                                That way potential clients could see my work and gain that trust all in one place.
                            </p>
                            
                            <div class="info-stats">
                                <div class="info-stat">
                                    <div class="stat-label">Date</div>
                                    <div class="stat-value">February 23, 2025</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Category</div>
                                    <div class="stat-value">Web Development</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Role</div>
                                    <div class="stat-value">Full Stack Developer</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3 class="info-card-title">My Approach</h3>
                        <div class="info-card-content">
                            <p>
                                I began this project by first building the foundation using Django. At first it was just the home
                                page and soon expanded to more as my outlined my ideas and drummed up exactly how I wanted it to
                                look. My focus on projects like this is centered around the idea of "How can I make it look amazing
                                and function perfectly". 
                                <br></br>

                                I've learned what works and what doesn't with clients, so I had to create
                                a great first impression with this project. Understanding the fundamentals I wanted to change was
                                crucial to the development of this website.
                            </p>
                            
                            <div class="info-stats">
                                <div class="info-stat">
                                    <div class="stat-label">Tech Stack</div>
                                    <div class="stat-value">Django, HTML, CSS, Python, Bash, JavaScript, SQL</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Timeline</div>
                                    <div class="stat-value">3 Months</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Purpose</div>
                                    <div class="stat-value">Personal Portfolio and E-Commerce Platform</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Technical Details Section -->
            <section class="content-section" id="technical">
                <div class="section-header">
                    <h2 class="section-title" style="margin-top: -50px;">Technical Details</h2>
                    <p class="section-subtitle">A deeper look at the development process and implementation</p>
                </div>
                
                <div class="tech-details">
                    <h3>Development Process</h3>
                    <p>
                        I began by creating my 'MAIN' django app which hosts the home page, contact page, and about me page. I wanted this
                        app to be the foundation of the project as this is what users would most likely see when they first connect, so I had to make
                        a strong first impression. 
                        <br></br>

                        Secondly, I moved onto my 'ACCOUNTS' app. This was the first building block of the E-Commerce
                        side of my website. I needed it to include secure account functionality along with a user-friendly interface. I made many secure
                        additions by employing an admin user-management panel ultilizing CRUD operations. Additionally, I included Google's O-Authentication to allow users
                        to create or login to my website using their secure Google accounts. I also included a custom profanity filter to censor any inappropiate language and also including AWS Image Recognition Software to stop any harmful
                        images from being uploaded and displayed on the promotional wall page. Which is a part of my site entirely dedicated to users and offering them
                        the ability to showcase their own social medias and projects. 
                        <br></br>

                        Next, I created my 'PORTFOLIO' app, this is where all my completed work would
                        be hosted and designed in a way to appeal to potential employers and clients alike. It showcases step-by-step my hardwork and offers a chance
                        for everyone to view my projects. 
                        <br></br>
                        
                        Lastly, I started on my 'STORE' app. I saved this for last as I needed the 'ACCOUNTS' app complete 
                        due to user's needing an account to purchase and track their orders. This app was the most complex as it needed to be able to handle
                        multiple users at once, and a large influx of orders which all display each unique user's order and information. Not only that, but
                        offer a secure checkout process that was user-friendly and instilled trust within clients. Furthermore, on the admin side,
                        I can track orders through an analytics panel that gives me every order detail, click-rates, finincial information, and more.
                        All in all, I broke my website down into four corners and built each one up to be a strong foundation accounting for all possiblities.
                        <br></br>

                        Finally, after getting everything put together, I launched my website using Cloud Run through the Google Cloud Console. Deploying my container
                        was a struggle. I had no idea what I was doing at first, but through grit and one long weekend I was able to get the containers deployed. I also installed
                        a PostgreSQL database to store my data persistently along with Google Buckets to store my user-uploads like profile pictures and my stream assets for the stream store.
                        Additionally, I've added CRON Schedular jobs to handle my emailing system for orders and messages all done on the website. That way clients get their invoices and users
                        get reminded if they have unread messages!
                        <br></br>
                        
                        All together, Bomby runs great and effectively handles all the jobs it needs to do. While also allowing me to easily come in and customize what needs updating or refining!
                    </p>
                    
                    <h3>Technical Challenges</h3>
                    <p>
                        The biggest hurdle to get over at first was organizing the different django apps and stringing them together to make sure they all worked together.
                        The 'STORE' app is built of the foundation off the 'ACCOUNTS' app, and all the apps (including 'PORTFOLIO') are all built off of
                        the 'MAIN' app. Getting this organizational structure put together was a challenge with trying to figure out exactly how to link
                        them all together.
                        <br></br>

                        This project did not progress without any setbacks however. Through optimizing my website, I discovered a critical error with my
                        CSS files that led to users downloading EVERY file on every single page of the website. Identifying the issue and finding a solution
                        led me to discover that all my CSS files were being piped through my base.html (the navbar, footer, etc.). Fixing this led to
                        styling errors over the entire website. I had to go back and reformat all CSS and HTML files to look great and this time make them
                        look even better than they did prior to the error. Fixing this critical error massively reduced load times across the entire website and led to a more professional look.
                        <br></br>

                        Another problem I faced was the incredible challenge of trying to deploy my website via Cloud Run. From never having used a service like Cloud Run
                        it was overwhelming at first. I had issues trying to get my stylesheets to load properly. Then I had issues getting my data to load (which led to me setting up the PostgreSQL database).
                        After that I then had to get my profile picture upload process working right and submitting files to a Google Bucket. Finally I had to get my stream assets
                        to be included in the bucket properly so that clients could download them seamlessly. Overall, I created and configured a secure and functional Cloud Run website
                        that functions smoothly.
                    </p>
                    
                    <pre>
// Example code snippet
class Product(models.Model):
    name = models.CharField(max_length=100)
    price = models.DecimalField(max_digits=8, decimal_places=2, null=True, blank=True)
    description = models.TextField(blank=True)
    is_active = models.BooleanField(default=True)
    
    def __str__(self):
        return self.name
</pre>
                    
                    <h3>Key Features</h3>
                    <ul>
                        <li>Complete E-Commerce Platform for multiple services</li>
                        <li>Secure and Protected User Account Functionality</li>
                        <li>Dynamic and Purposeful Admin Management</li>
                        <li>Custom Graphic Design and Personality</li>
                    </ul>
                    
                    <h3>Lessons Learned</h3>
                    <p>
                        Through working on this project I learned the importance of organization and structure. Stringing together
                        multiple parts of the website seamlessly was a challenge but I learned how to do it purposefully and effectively.
                        <br></br>

                        At the beginning of 2025, I had no idea how to build a website, let alone a full E-Commerce platform. However, through
                        learning the Django framework I've become confident in my abilities to deliver a strong online presence.
                    </p>
                </div>
            </section>
            
            <!-- Contact CTA Section -->
            <section class="contact-cta">
                <div class="cta-content">
                    <h2>INTERESTED IN MY WORK?</h2>
                    <p>I'm available for freelance projects and would love to discuss how I can help bring your ideas to life.</p>
                    <a href="{% url 'MAIN:contact' %}" class="cta-button">GET IN TOUCH</a>
                </div>
            </section>
        </div>

        <!-- Lightbox Modal -->
        <div id="lightboxModal" class="lightbox-modal">
            <span class="close-modal">&times;</span>
            <div class="lightbox-content">
                <img id="lightboxImage" src="" alt="Lightbox Image">
                <div class="lightbox-nav">
                    <button id="prevButton" class="nav-button"><i class="fas fa-chevron-left"></i></button>
                    <button id="nextButton" class="nav-button"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Initialize AOS animation library
        AOS.init({
            duration: 800,
            offset: 100,
            once: true
        });
        
        // DOM manipulation safety wrapper
        function safelyExecute(fn) {
            try {
                fn();
            } catch (error) {
                console.warn('Error in execution:', error);
            }
        }
        
        // Main initialization when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {

            // Full screen featured image
            initLightbox();

            // Gallery functionality
            safelyExecute(() => {
                const featuredImage = document.getElementById('featuredImage');
                const thumbnails = document.querySelectorAll('.thumbnail');
                
                const inactiveThumbnails = document.querySelectorAll('.thumbnail:not(.active)');
                inactiveThumbnails.forEach(thumb => {
                    thumb.style.border = '2px solid #444';
                });
                
                thumbnails.forEach(thumb => {
                    thumb.addEventListener('click', function() {
                        featuredImage.src = this.dataset.image;
                        thumbnails.forEach(t => {
                            t.classList.remove('active');
                            t.style.border = '2px solid #444';
                        });
                        this.classList.add('active');
                        this.style.border = '2px solid #ffffff';
                    });
                });
            });
            
            // Scroll animation for content sections
            safelyExecute(() => {
                const contentSections = document.querySelectorAll('.content-section');
                
                if (contentSections.length > 0) {
                    const observerOptions = {
                        root: null,
                        rootMargin: '0px',
                        threshold: 0.1
                    };
                    
                    const observer = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('visible');
                            }
                        });
                    }, observerOptions);
                    
                    contentSections.forEach(section => {
                        observer.observe(section);
                    });
                }
            });
            
            // Call initial layout adjustments
            adjustLayout();
            
            // GitHub API integration
            safelyExecute(() => {
                const username = 'smk37git';
                const repo = 'BOMBY';
                
                fetchLatestCommit(username, repo);
            });
        });
        
        // Adjust layout for responsive design
        function adjustLayout() {
            const isMobile = window.innerWidth <= 768;
            
            // Featured image container adjustment
            safelyExecute(() => {
                const featuredImageContainer = document.querySelector('.project-featured-image');
                
                if (featuredImageContainer) {
                    featuredImageContainer.style.width = isMobile ? '90%' : '100%';
                    featuredImageContainer.style.maxWidth = isMobile ? '320px' : '900px';
                    featuredImageContainer.style.margin = isMobile ? '0 auto 1rem' : '0 auto 1.5rem';
                }
            });
            
            // Gallery thumbnails adjustment
            safelyExecute(() => {
                const galleryThumbnails = document.querySelector('.gallery-thumbnails');
                
                if (galleryThumbnails) {
                    galleryThumbnails.style.width = isMobile ? '90%' : '100%';
                    galleryThumbnails.style.maxWidth = isMobile ? '320px' : '900px';
                    galleryThumbnails.style.gap = isMobile ? '0.4rem' : '1rem';
                }
            });
        }
        
        // Listen for window resize events
        window.addEventListener('resize', adjustLayout);
        
        // GitHub commit fetching
        function fetchLatestCommit(username, repo) {
            const apiUrl = `/portfolio/api/github-commit/${username}/${repo}/`;
            
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => updateCommitDisplay(data, username, repo))
                .catch(error => {
                    console.error('Error fetching commit data:', error);
                    // Display fallback message
                    const container = document.querySelector('.github-commit-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="github-header">
                                <a href="https://github.com/${username}" class="github-logo">
                                    <i class="fab fa-github"></i>
                                    <span>GitHub Repository</span>
                                </a>
                                <a href="https://github.com/${username}/${repo}" class="repo-link">
                                    <i class="fas fa-code-branch"></i> View Repository
                                </a>
                            </div>
                            <div class="github-commit" style="padding: 1.5rem; text-align: center;">
                                <p>Unable to load latest commit information. Please check the repository directly.</p>
                            </div>
                        `;
                    }
                });
        }
        
        // Update commit display with fetched data
        function updateCommitDisplay(commit, username, repo) {
            // Safety check
            if (!commit || !commit.commit) return;
            
            // Format the commit date
            const commitDate = new Date(commit.commit.author.date);
            const timeAgo = getTimeAgo(commitDate);
            
            // Get the shortened commit hash
            const shortHash = commit.sha ? commit.sha.substring(0, 7) : '';
            
            // Get author info
            const authorName = commit.commit.author.name;
            const authorAvatar = commit.author ? commit.author.avatar_url : 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png';
            
            // Get stats if available
            const additions = commit.stats ? commit.stats.additions : 0;
            const deletions = commit.stats ? commit.stats.deletions : 0;
            
            // Update the DOM with the latest commit info
            const container = document.querySelector('.github-commit-container');
            if (!container) return;
            
            container.innerHTML = `
                <div class="github-header">
                    <a href="https://github.com/${username}" class="github-logo">
                        <i class="fab fa-github"></i>
                        <span>Latest GitHub Commit</span>
                    </a>
                    <a href="https://github.com/${username}/${repo}" class="repo-link">
                        <i class="fas fa-code-branch"></i> View Repository
                    </a>
                </div>
                
                <div class="github-commit">
                    <div class="commit-message">
                        <i class="fas fa-code-commit"></i>
                        <div class="commit-message-text">
                            ${escapeHtml(commit.commit.message)}
                            <span class="commit-hash" title="Click to copy" onclick="copyToClipboard('${shortHash}')">${shortHash}</span>
                        </div>
                    </div>
                    
                    <div class="commit-details">
                        <div class="commit-author">
                            <img src="${authorAvatar}" alt="${authorName}" class="author-avatar">
                            <span class="author-name">${authorName}</span>
                        </div>
                        
                        <div class="commit-stats">
                            <div class="commit-stat">
                                <i class="far fa-clock"></i>
                                <span>${timeAgo}</span>
                            </div>
                            <div class="commit-stat">
                                <i class="fas fa-plus-circle" style="color: #2cbe4e;"></i>
                                <span>${additions}</span>
                            </div>
                            <div class="commit-stat">
                                <i class="fas fa-minus-circle" style="color: #cb2431;"></i>
                                <span>${deletions}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Helper function to format time ago
        function getTimeAgo(date) {
            if (!date || isNaN(date.getTime())) return '';
            
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return interval + ' years ago';
            if (interval === 1) return interval + ' year ago';
            
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return interval + ' months ago';
            if (interval === 1) return interval + ' month ago';
            
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return interval + ' days ago';
            if (interval === 1) return interval + ' day ago';
            
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return interval + ' hours ago';
            if (interval === 1) return interval + ' hour ago';
            
            interval = Math.floor(seconds / 60);
            if (interval > 1) return interval + ' minutes ago';
            if (interval === 1) return interval + ' minute ago';
            
            return 'just now';
        }
        
        // Helper function to prevent XSS
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // Copy to clipboard function
        function copyToClipboard(text) {
            if (!text) return;
            
            navigator.clipboard.writeText(text).then(function() {
                // Create temporary tooltip
                const tooltip = document.createElement('div');
                tooltip.textContent = 'Copied!';
                tooltip.style.position = 'fixed';
                tooltip.style.backgroundColor = 'rgba(0, 255, 65, 0.9)';
                tooltip.style.color = '#0c0c0c';
                tooltip.style.padding = '5px 10px';
                tooltip.style.borderRadius = '3px';
                tooltip.style.fontSize = '0.8rem';
                tooltip.style.fontWeight = 'bold';
                tooltip.style.zIndex = '1000';
                
                // Position near hash element - with safety check
                const hashElement = document.querySelector('.commit-hash');
                if (hashElement) {
                    const rect = hashElement.getBoundingClientRect();
                    tooltip.style.left = `${rect.right + 10}px`;
                    tooltip.style.top = `${rect.top}px`;
                } else {
                    // Fallback positioning
                    tooltip.style.left = '50%';
                    tooltip.style.top = '50%';
                    tooltip.style.transform = 'translate(-50%, -50%)';
                }
                
                document.body.appendChild(tooltip);
                
                // Remove after 2 seconds
                setTimeout(() => {
                    tooltip.style.opacity = '0';
                    tooltip.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        if (document.body.contains(tooltip)) {
                            document.body.removeChild(tooltip);
                        }
                    }, 500);
                }, 1500);
            }).catch(function(error) {
                console.error('Error copying text: ', error);
            });
        }

        // Lightbox functionality
        function initLightbox() {
            const modal = document.getElementById('lightboxModal');
            const modalImg = document.getElementById('lightboxImage');
            const closeBtn = document.querySelector('.close-modal');
            const prevBtn = document.getElementById('prevButton');
            const nextBtn = document.getElementById('nextButton');
            const featuredImage = document.getElementById('featuredImage');
            const thumbnails = document.querySelectorAll('.thumbnail');
            
            // Current image index
            let currentIndex = 0;
            
            // Get all image sources from thumbnails
            const imageSources = Array.from(thumbnails).map(thumb => thumb.dataset.image);
            
            // Open lightbox when clicking on featured image
            featuredImage.addEventListener('click', function() {
                modal.style.display = 'block';
                modalImg.src = this.src;
                
                // Find the current index
                currentIndex = imageSources.indexOf(this.src);
                
                // Disable scrolling on body
                document.body.style.overflow = 'hidden';
            });
            
            // Close the lightbox
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // Close on click outside the image
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Previous image
            prevBtn.addEventListener('click', function() {
                currentIndex = (currentIndex - 1 + imageSources.length) % imageSources.length;
                modalImg.src = imageSources[currentIndex];
            });
            
            // Next image
            nextBtn.addEventListener('click', function() {
                currentIndex = (currentIndex + 1) % imageSources.length;
                modalImg.src = imageSources[currentIndex];
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (modal.style.display === 'block') {
                    if (e.key === 'ArrowLeft') {
                        prevBtn.click();
                    } else if (e.key === 'ArrowRight') {
                        nextBtn.click();
                    } else if (e.key === 'Escape') {
                        closeBtn.click();
                    }
                }
            });
        }
    </script>
{% endblock %}