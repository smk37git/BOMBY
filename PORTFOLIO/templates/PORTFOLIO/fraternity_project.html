{% extends 'MAIN/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/bomby_page.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
{% endblock %}

{% block background %}
    {% include 'MAIN/base_background.html' %}
{% endblock %}

{% block content %}
    <div class="project-container">
        <!-- Horizontal Split Hero Section -->
        <section class="hero-split">
            <!-- Left Side - Hero Content -->
            <div class="hero-content-side">
                <h1 class="project-title">FRATERNITY WEBSITE PROJECT
                </h1>
                <p class="project-author">By Sebastian Main and WebDev Team</p>
                <p class="project-brief">
                    Σ Φ Δ
                    <br></br>

                    A modern web development project showcasing frontend and backend skills with a focus on revitalizing our fraternity's online presence.
                    Our old website was a broken and buggy mess, so we needed to start from the ground up and include more features and a more user-friendly interface.
                </p>
                
                <div class="hero-cta">
                    <a href="{% url 'PORTFOLIO:portfolio' %}" class="hero-button">
                        <i class="fas fa-arrow-left"></i> Back to Portfolio
                    </a>
                    <a href="https://www.sigmaphideltamizzou.online" class="hero-button primary">View Live</a>
                    <a href="https://github.com/smk37git/SPDWEBAPP_ENV" class="hero-button">GitHub Repo</a>
                </div>
            </div>
            
            <!-- Right Side - Gallery -->
            <div class="hero-gallery-side">
                <div class="project-featured-image">
                    <img src="{% static 'images/Fraternity_Project_1.jpg' %}" alt="Project Name" class="featured-image" id="featuredImage">
                </div>
                
                <div class="gallery-thumbnails">
                    <div class="thumbnail active" data-image="{% static 'images/Fraternity_Project_1.jpg' %}">
                        <img src="{% static 'images/Fraternity_Project_1.jpg' %}" alt="Main Project Image">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/Fraternity_Project_2.jpg' %}">
                        <img src="{% static 'images/Fraternity_Project_2.jpg' %}" alt="Gallery Image 1">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/Fraternity_Project_3.jpg' %}">
                        <img src="{% static 'images/Fraternity_Project_3.jpg' %}" alt="Gallery Image 2">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/Fraternity_Project_4.jpg' %}">
                        <img src="{% static 'images/Fraternity_Project_4.jpg' %}" alt="Gallery Image 3">
                    </div>
                    <div class="thumbnail" data-image="{% static 'images/Fraternity_Project_5.jpg' %}">
                        <img src="{% static 'images/Fraternity_Project_5.jpg' %}" alt="Gallery Image 4">
                    </div>
                </div>
            </div>
        </section>
        
        <!-- GitHub Commit Display Container -->
        <div class="github-commit-container">
            <!-- This will be populated by scripts below -->
            <div class="github-header">
                <a href="https://github.com/smk37git/SPDWEBAPP_ENV" class="github-logo">
                    <i class="fab fa-github"></i>
                    <span>Loading commit data...</span>
                </a>
            </div>
            <div class="github-commit" style="padding: 1.5rem; text-align: center;">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: rgba(255, 255, 255, 0.5);"></i>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="project-content">
            <!-- Overview Section -->
            <section class="content-section" id="overview">
                <div class="section-header">
                    <h2 class="section-title" style="margin-top: 100px;">Project Overview</h2>
                    <p class="section-subtitle">A detailed look at the purpose and approach of this project</p>
                </div>
                
                <div class="project-info-grid">
                    <div class="info-card">
                        <h3 class="info-card-title">The Project</h3>
                        <div class="info-card-content">
                            <p>
                                Our Fraternity Website was constructed on the basis of elevating our online presence. As an Engineering organization, we
                                had to think deeply about exactly how we wanted our website to function. We decided to include a plethora of features for both
                                visitors and brothers alike. Featuring dashboards for our fraternity members to keep up with events and annoucements to data management
                                to track philanthropy hours. 
                                <br></br>

                                Our website had to be the one-stop-shop for the future of our fraternity.
                            </p>
                            
                            <div class="info-stats">
                                <div class="info-stat">
                                    <div class="stat-label">Date</div>
                                    <div class="stat-value">January 23, 2025</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Category</div>
                                    <div class="stat-value">Web Development</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Role</div>
                                    <div class="stat-value">Full Stack Developer</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3 class="info-card-title">Our Approach</h3>
                        <div class="info-card-content">
                            <p>
                                We started by organizing our teams goal. What did we want to achieve that our old website couldn't?
                                We landed on stability, functionality, a modern look, and the idea that our website would be built upon
                                for years to come. We wanted to avoid repeating past mistakes by having a website that can be understood
                                and maintained by future brothers elected to the WebDev team. So we drafted our project plan and got to work the
                                same night.
                            </p>
                            
                            <div class="info-stats">
                                <div class="info-stat">
                                    <div class="stat-label">Tech Stack</div>
                                    <div class="stat-value">Django, React, SQL</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Timeline</div>
                                    <div class="stat-value">6 Months</div>
                                </div>
                                <div class="info-stat">
                                    <div class="stat-label">Purpose</div>
                                    <div class="stat-value">Rebuilt Website with Functionality for the Fraternity</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Technical Details Section -->
            <section class="content-section" id="technical">
                <div class="section-header">
                    <h2 class="section-title" style="margin-top: -50px;">Technical Details</h2>
                    <p class="section-subtitle">A deeper look at the development process and implementation</p>
                </div>
                
                <div class="tech-details">
                    <h3>Development Process</h3>
                    <p>
                        We began this project by first building the foundation using Django. From there we assigned various tasks
                        to each team member in our WebDev team to complete. First we had to create the 'HOME' app which would cover what visitors
                        would see when making their way to our website. Featuring our History, Code of Ethics, Rush Information, and Homepage.
                        <br></br>
                        
                        Secondly, with the 'AUTHENTICATE' app, which was developed to
                        handle our user authentication and account management. We had to cover all bases with this app as we had a hierachy of users
                        that needed to function right. We creates different levels like 'Alumni', 'Executive', 'Brother', 'Potential New Member', and more!
                        <br></br>

                        Next, we focused on our ability to have real-time polls to better run our weekly fraternity chapter. We created 'PARLEY-PRO' to handle
                        real-time user interaction where brothers can vote 'Aye' or 'Nay' on any topic that our Executive Board poses.
                        <br></br>

                        Lastly, we wanted to focus on providing better tools for our brothers. By creating the 'PHILANTHROPY' and 'NEWMEMBER' apps we had better control
                        over our information about tracking hours needed for brothers and up to date information on new members. Knowing how both were progressing
                        with completing their goals for the semester.
                        <br></br>
                        
                        All together, our website is a massive upgrade from our previous one. We plan to host it locally to maximize cost-effectiveness and 
                        allow us to have full control over our project.
                    </p>
                    
                    <h3>Technical Challenges</h3>
                    <p>
                        Our biggest challenge in this project was trying to navigate around each other while we built the website. With a team of four active contributors
                        and two brothers in training, it left us sometimes having conflicting work spaces which effectively rendered some updates actually setting us back.
                        <br></br>

                        By learning together how to function in a fullstack Web Development team we were able to figure out how to ultilize our workspaces more purposefully. By sitting down
                        during our meetings and understanding how our GitHub worked and how to branch the code we started having better design patterns and ran into near zero conflicts down the line.
                        <br></br>
                        
                        All in all, my brothers and I were able to develop the website exactly how we envisioned and we are proud of the work we've done. We plan to continue to update the website
                        into the future so that it can be a tool for future brothers to use and enjoy.
                    </p>
                    
                    <pre>
// Example code snippet
@login_required # Used for Live Update
def poll_results(request):
    aye_votes = Brother_votes.objects.filter(user_vote_choice='Aye').count()
    nay_votes = Brother_votes.objects.filter(user_vote_choice='Nay').count()
    return JsonResponse({
        'aye_votes': aye_votes,
        'nay_votes': nay_votes
    })
</pre>
                    
                    <h3>Key Features</h3>
                    <ul>
                        <li>Fully Functional Website for the Fraternity</li>
                        <li>Secure and Protected User Account Functionality</li>
                        <li>Multiple Tools for Fraternity Members</li>
                        <li>Custom Graphic Design and Branding</li>
                    </ul>
                    
                    <h3>Lessons Learned</h3>
                    <p>
                        Through working on this project I became more ingrained within my fraternity and really understood the principles of which we are
                        founded upon. Science, Friendship, and Duty are the three pillars of our organization and it felt great to be apart of something
                        where I could demonstrate these attributes. It fueled my desire to learn more about website development including frontend, backend, 
                        django framework, and google cloud services.
                    </p>
                </div>
            </section>
            
            <!-- Contact CTA Section -->
            <section class="contact-cta">
                <div class="cta-content">
                    <h2>INTERESTED IN MY WORK?</h2>
                    <p>I'm available for freelance projects and would love to discuss how I can help bring your ideas to life.</p>
                    <a href="{% url 'MAIN:contact' %}" class="cta-button">GET IN TOUCH</a>
                </div>
            </section>
        </div>

        <!-- Lightbox Modal -->
        <div id="lightboxModal" class="lightbox-modal">
            <span class="close-modal">&times;</span>
            <div class="lightbox-content">
                <img id="lightboxImage" src="" alt="Lightbox Image">
                <div class="lightbox-nav">
                    <button id="prevButton" class="nav-button"><i class="fas fa-chevron-left"></i></button>
                    <button id="nextButton" class="nav-button"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Initialize AOS animation library
        AOS.init({
            duration: 800,
            offset: 100,
            once: true
        });
        
        // DOM manipulation safety wrapper
        function safelyExecute(fn) {
            try {
                fn();
            } catch (error) {
                console.warn('Error in execution:', error);
            }
        }
        
        // Main initialization when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {

            // Full screen featured image
            initLightbox();

            // Gallery functionality
            safelyExecute(() => {
                const featuredImage = document.getElementById('featuredImage');
                const thumbnails = document.querySelectorAll('.thumbnail');
                
                if (featuredImage && thumbnails.length > 0) {
                    const inactiveThumbnails = document.querySelectorAll('.thumbnail:not(.active)');
                    inactiveThumbnails.forEach(thumb => {
                        thumb.style.border = '2px solid #444';
                    });
                    
                    thumbnails.forEach(thumb => {
                        thumb.addEventListener('click', function() {
                            featuredImage.src = this.dataset.image;
                            thumbnails.forEach(t => {
                                t.classList.remove('active');
                                t.style.border = '2px solid #444';
                            });
                            this.classList.add('active');
                            this.style.border = '2px solid #ffffff';
                        });
                    });
                }
            });
            
            // Scroll animation for content sections
            safelyExecute(() => {
                const contentSections = document.querySelectorAll('.content-section');
                
                if (contentSections.length > 0) {
                    const observerOptions = {
                        root: null,
                        rootMargin: '0px',
                        threshold: 0.1
                    };
                    
                    const observer = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('visible');
                            }
                        });
                    }, observerOptions);
                    
                    contentSections.forEach(section => {
                        observer.observe(section);
                    });
                }
            });
            
            // Call initial layout adjustments
            adjustLayout();
            
            // GitHub API integration
            safelyExecute(() => {
                const username = 'smk37git';
                const repo = 'SPDWEBAPP_ENV';
                
                fetchLatestCommit(username, repo);
            });
        });
        
        // Adjust layout for responsive design
        function adjustLayout() {
            const isMobile = window.innerWidth <= 768;
            
            // Featured image container adjustment
            safelyExecute(() => {
                const featuredImageContainer = document.querySelector('.project-featured-image');
                
                if (featuredImageContainer) {
                    featuredImageContainer.style.width = isMobile ? '90%' : '100%';
                    featuredImageContainer.style.maxWidth = isMobile ? '320px' : '900px';
                    featuredImageContainer.style.margin = isMobile ? '0 auto 1rem' : '0 auto 1.5rem';
                }
            });
            
            // Gallery thumbnails adjustment
            safelyExecute(() => {
                const galleryThumbnails = document.querySelector('.gallery-thumbnails');
                
                if (galleryThumbnails) {
                    galleryThumbnails.style.width = isMobile ? '90%' : '100%';
                    galleryThumbnails.style.maxWidth = isMobile ? '320px' : '900px';
                    galleryThumbnails.style.gap = isMobile ? '0.4rem' : '1rem';
                }
            });
        }
        
        // Listen for window resize events
        window.addEventListener('resize', adjustLayout);
        
        // GitHub commit fetching
        function fetchLatestCommit(username, repo) {
            const apiUrl = `/portfolio/api/github-commit/${username}/${repo}/`;
            
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => updateCommitDisplay(data, username, repo))
                .catch(error => {
                    console.error('Error fetching commit data:', error);
                    // Display fallback message
                    const container = document.querySelector('.github-commit-container');
                    if (container) {
                        container.innerHTML = `
                            <div class="github-header">
                                <a href="https://github.com/${username}" class="github-logo">
                                    <i class="fab fa-github"></i>
                                    <span>GitHub Repository</span>
                                </a>
                                <a href="https://github.com/${username}/${repo}" class="repo-link">
                                    <i class="fas fa-code-branch"></i> View Repository
                                </a>
                            </div>
                            <div class="github-commit" style="padding: 1.5rem; text-align: center;">
                                <p>Unable to load latest commit information. Please check the repository directly.</p>
                            </div>
                        `;
                    }
                });
        }
        
        // Update commit display with fetched data
        function updateCommitDisplay(commit, username, repo) {
            // Safety check
            if (!commit || !commit.commit) return;
            
            // Format the commit date
            const commitDate = new Date(commit.commit.author.date);
            const timeAgo = getTimeAgo(commitDate);
            
            // Get the shortened commit hash
            const shortHash = commit.sha ? commit.sha.substring(0, 7) : '';
            
            // Get author info
            const authorName = commit.commit.author.name;
            const authorAvatar = commit.author ? commit.author.avatar_url : 'https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png';
            
            // Get stats if available
            const additions = commit.stats ? commit.stats.additions : 0;
            const deletions = commit.stats ? commit.stats.deletions : 0;
            
            // Update the DOM with the latest commit info
            const container = document.querySelector('.github-commit-container');
            if (!container) return;
            
            container.innerHTML = `
                <div class="github-header">
                    <a href="https://github.com/${username}" class="github-logo">
                        <i class="fab fa-github"></i>
                        <span>Latest GitHub Commit</span>
                    </a>
                    <a href="https://github.com/${username}/${repo}" class="repo-link">
                        <i class="fas fa-code-branch"></i> View Repository
                    </a>
                </div>
                
                <div class="github-commit">
                    <div class="commit-message">
                        <i class="fas fa-code-commit"></i>
                        <div class="commit-message-text">
                            ${escapeHtml(commit.commit.message)}
                            <span class="commit-hash" title="Click to copy" onclick="copyToClipboard('${shortHash}')">${shortHash}</span>
                        </div>
                    </div>
                    
                    <div class="commit-details">
                        <div class="commit-author">
                            <img src="${authorAvatar}" alt="${authorName}" class="author-avatar">
                            <span class="author-name">${authorName}</span>
                        </div>
                        
                        <div class="commit-stats">
                            <div class="commit-stat">
                                <i class="far fa-clock"></i>
                                <span>${timeAgo}</span>
                            </div>
                            <div class="commit-stat">
                                <i class="fas fa-plus-circle" style="color: #2cbe4e;"></i>
                                <span>${additions}</span>
                            </div>
                            <div class="commit-stat">
                                <i class="fas fa-minus-circle" style="color: #cb2431;"></i>
                                <span>${deletions}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Helper function to format time ago
        function getTimeAgo(date) {
            if (!date || isNaN(date.getTime())) return '';
            
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return interval + ' years ago';
            if (interval === 1) return interval + ' year ago';
            
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return interval + ' months ago';
            if (interval === 1) return interval + ' month ago';
            
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return interval + ' days ago';
            if (interval === 1) return interval + ' day ago';
            
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return interval + ' hours ago';
            if (interval === 1) return interval + ' hour ago';
            
            interval = Math.floor(seconds / 60);
            if (interval > 1) return interval + ' minutes ago';
            if (interval === 1) return interval + ' minute ago';
            
            return 'just now';
        }
        
        // Helper function to prevent XSS
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // Copy to clipboard function
        function copyToClipboard(text) {
            if (!text) return;
            
            navigator.clipboard.writeText(text).then(function() {
                // Create temporary tooltip
                const tooltip = document.createElement('div');
                tooltip.textContent = 'Copied!';
                tooltip.style.position = 'fixed';
                tooltip.style.backgroundColor = 'rgba(0, 255, 65, 0.9)';
                tooltip.style.color = '#0c0c0c';
                tooltip.style.padding = '5px 10px';
                tooltip.style.borderRadius = '3px';
                tooltip.style.fontSize = '0.8rem';
                tooltip.style.fontWeight = 'bold';
                tooltip.style.zIndex = '1000';
                
                // Position near hash element - with safety check
                const hashElement = document.querySelector('.commit-hash');
                if (hashElement) {
                    const rect = hashElement.getBoundingClientRect();
                    tooltip.style.left = `${rect.right + 10}px`;
                    tooltip.style.top = `${rect.top}px`;
                } else {
                    // Fallback positioning
                    tooltip.style.left = '50%';
                    tooltip.style.top = '50%';
                    tooltip.style.transform = 'translate(-50%, -50%)';
                }
                
                document.body.appendChild(tooltip);
                
                // Remove after 2 seconds
                setTimeout(() => {
                    tooltip.style.opacity = '0';
                    tooltip.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => {
                        if (document.body.contains(tooltip)) {
                            document.body.removeChild(tooltip);
                        }
                    }, 500);
                }, 1500);
            }).catch(function(error) {
                console.error('Error copying text: ', error);
            });
        }

        // Lightbox functionality
        function initLightbox() {
            const modal = document.getElementById('lightboxModal');
            const modalImg = document.getElementById('lightboxImage');
            const closeBtn = document.querySelector('.close-modal');
            const prevBtn = document.getElementById('prevButton');
            const nextBtn = document.getElementById('nextButton');
            const featuredImage = document.getElementById('featuredImage');
            const thumbnails = document.querySelectorAll('.thumbnail');
            
            // Current image index
            let currentIndex = 0;
            
            // Get all image sources from thumbnails
            const imageSources = Array.from(thumbnails).map(thumb => thumb.dataset.image);
            
            // Open lightbox when clicking on featured image
            featuredImage.addEventListener('click', function() {
                modal.style.display = 'block';
                modalImg.src = this.src;
                
                // Find the current index
                currentIndex = imageSources.indexOf(this.src);
                
                // Disable scrolling on body
                document.body.style.overflow = 'hidden';
            });
            
            // Close the lightbox
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // Close on click outside the image
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Previous image
            prevBtn.addEventListener('click', function() {
                currentIndex = (currentIndex - 1 + imageSources.length) % imageSources.length;
                modalImg.src = imageSources[currentIndex];
            });
            
            // Next image
            nextBtn.addEventListener('click', function() {
                currentIndex = (currentIndex + 1) % imageSources.length;
                modalImg.src = imageSources[currentIndex];
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (modal.style.display === 'block') {
                    if (e.key === 'ArrowLeft') {
                        prevBtn.click();
                    } else if (e.key === 'ArrowRight') {
                        nextBtn.click();
                    } else if (e.key === 'Escape') {
                        closeBtn.click();
                    }
                }
            });
        }
    </script>
{% endblock %}