{% extends 'MAIN/base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/store_item.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
{% endblock %}

{% block background %}
    {% include 'MAIN/base_background_starry.html' %}
{% endblock %}

{% block content %}
<div class="product-container">
    <!-- Back link -->
    <div class="product-navigation">
        <a href="{% url 'STORE:store' %}" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Store
        </a>
    </div>
    
    <!-- Split layout for product -->
    <div class="product-split">
        <!-- Left side: Gallery -->
        <div class="product-gallery-side">
            <div class="product-featured-image">
                <div id="featured-container" style="background: #0a0a0a;">
                    <video id="featuredVideo" class="featured-image" controls style="display: none;">
                        <source src="{% static 'videos/Bomby_Stream_Setup.mp4' %}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <img src="{% static 'images/stream_setup_1.jpg' %}" alt="Basic Package" class="featured-image" id="featuredImage">
                </div>
            </div>
            
            <div class="gallery-thumbnails">
                <!-- Thumbnails -->
                <div class="thumbnail video-thumb active" data-type="video" data-src="{% static 'videos/Bomby_Stream_Setup.mp4' %}">
                    <img src="{% static 'images/stream_setup_1.jpg' %}" alt="Video Thumbnail">
                    <div class="play-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                </div>
                <div class="thumbnail" data-image="{% static 'images/my_stream_setup_2.jpg' %}">
                    <img src="{% static 'images/my_stream_setup_2.jpg' %}" alt="Gallery Image 2">
                </div>
                <div class="thumbnail" data-image="{% static 'images/my_stream_setup_3.jpg' %}">
                    <img src="{% static 'images/my_stream_setup_3.jpg' %}" alt="Gallery Image 3">
                </div>
                <div class="thumbnail" data-image="{% static 'images/my_stream_setup_4.jpg' %}">
                    <img src="{% static 'images/my_stream_setup_4.jpg' %}" alt="Gallery Image 4">
                </div>
                <div class="thumbnail" data-image="{% static 'images/my_stream_setup_5.jpg' %}">
                    <img src="{% static 'images/my_stream_setup_5.jpg' %}" alt="Gallery Image 5">
                </div>
            </div>

            <div class="gallery-message-button">
                {% if user.is_authenticated %}
                    <a href="{% url 'STORE:message_general' %}" class="gallery-message-btn">
                        <i class="fas fa-comment-alt"></i> MESSAGE ME ABOUT MY SETUP
                    </a>
                {% else %}
                    <a href="{% url 'ACCOUNTS:login' %}?next={% url 'STORE:message_general' %}" class="gallery-message-btn">
                        <i class="fas fa-comment-alt"></i> MESSAGE ME ABOUT THIS SETUP
                    </a>
                {% endif %}
            </div>
        </div>
        
        <!-- Right side: Product info -->
        <div class="product-card">
            <h1 class="product-title">MY CUSTOM SETUP
                <div class="product-status {% if product.is_inactive %}active{% else %}active{% endif %}">
                    {% if product.is_inactive %}ACTIVE{% else %}ACTIVE{% endif %}
                </div>
            </h1>
            <hr class="page-divider"></hr>
            
            <div class="product-features-container">
                <div class="product-features" style="margin-right: 250px;">
                  <h2>FEATURES:</h2>
                  <ul class="features-list">
                    <li>
                      <i class="fas fa-check-circle"></i>
                      Precise Performance Enhancements
                    </li>
                    <li>
                      <i class="fas fa-check-circle"></i>
                      Professional Overlays and Graphics
                    </li>
                    <li>
                      <i class="fas fa-check-circle"></i>
                      Multiple Scenes with High Functionality
                    </li>
                    <li>
                      <i class="fas fa-check-circle"></i>
                      Chatbots / Interactivity / Fluid Transitions
                    </li>
                  </ul>
                </div>
                
                <div class="delivery-badge">
                    <i class="fa-solid fa-star"></i>
                    <span style="font-size: 1rem;">BEST OF THE BEST</span>
                </div>
            </div>

            <div class="product-purchase" style="display: inline-block; text-align: center;">
                <a href="{% url 'STORE:premium_package' %}" class="purchase-btn">WANT A SETUP LIKE THIS?</a>
            </div>
        </div>
    </div>
    
    <!-- Description section moved below gallery and product info -->
    <div class="product-description-section">
        <div class="product-card">
            <div class="product-description">
                <h2 class="heading-with-line">DESCRIPTION</h2>
                
                <p>
                    Lets bring your streaming/recording dreams to life! Message me your thoughts so we can start piecing together your setup!
                    I am a full-time Information Technology student and also a part-time streamer with over 1000+ hours streamed. 
                    I have years of experience on both sides of the playing field. Whether it's configuring the back-end of your setup or helping you attract more views to build your online career!
                    <br>
                    <br>
                    Are you feeling overwhelmed with trying to setup your stream yourself? After consulting with me you will feel confident and have the help you need!
                    <br>
                    <br>
                    Here is a list of the things I can setup and more:
                    <br>
                    <li class="description-text">OBS Stream Setup (Captures, Video Capture Devices, etc...)</li>
                    <li class="description-text">Output Settings (Encoding Settings, Tuning, Knowledge of the different Encoders)</li>
                    <li class="description-text">Best settings for your Computer Specs</li>
                    <li class="description-text">OBS troubleshooting (Video, Audio, etc...) -- Having low FPS issues? Let me fix that!</li>
                    <li class="description-text">Overlay integration (Adding graphics and making them look great!)</li>
                    <li class="description-text">Fluid and CUSTOM source transitions</li>
                    <li class="description-text">Multi-streaming</li>
                    <li class="description-text">Alert Boxes, Widgets, Panels, Sponsor Banners</li>
                    <li class="description-text">Connecting multiple services (Twitch/YouTube/TikTok/etc..) to your OBS!</li>
                    <li class="description-text">Windows/Mac</li>
                    <li class="description-text">Coaching to develop your success!</li>

                    <p class="description-text">Please read the FAQ and MESSAGE me!</p>
                </p>

                <h2 class="heading-with-line">MY CUSTOM SETUP SPECIFICS</h2>
                <p>
                    This is my ultimate setup after being a streamer for many years. It's completely customized specfically for my specifications and needs! From chatbots to fluid animated overlays, it's the ultimate experience for viewers!
                    <br>
                    <li class="description-text"><b>Professional Setup</b> -- My OBS is configured for picture-perfectrecording or streaming while ensuring essential settings are refined for a crystal clear picture.</li>
                    <br>
                    <li class="description-text"><b>Fluid Overlays and Transitions</b> -- Custom made (by Sebe) overlays and transitions designed to evoke my style and allow me to design creative scenes!</li>
                    <br>
                    <li class="description-text"><b>Chatbots and Alerts</b> -- Custom animated alerts and a chatbot customized to promote my socials (YouTube, Discord, Bomby, etc...) + commands for viewers to use and redeem items on stream!</li>
                </p>

                <h2 class="heading-with-line">MY STREAMING COMPONENTS AND GEAR</h2>
                <p>
                    <h3>Computer Components:</h3>
                    <li class="description-text"><b>GPU</b> -- EVGA RTX 3080 10GB <a href="https://amzn.to/4jtXBKv">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>CPU</b> -- AMD Ryzen 7 5700X3D Eight-Core <a href="https://amzn.to/4jmCmu8">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>SSD</b> -- Seagate FireCuda 2TB / 5400RPM <a href="https://amzn.to/4lCS1qy">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>HD</b> -- Western Digital Caviar 1TB / 7200RPM <a href="https://amzn.to/3EgRHgE">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Mother Board</b> -- MSI Gaming B450 Tomahawk <a href="https://amzn.to/3GkvJde">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>RAM</b> -- Corsair LPX 32GB (4x8GB) <a href="https://amzn.to/4iszIBS">[View Item]</a></li>
                    <br>

                    <h3>Streaming Gear:</h3>
                    <li class="description-text"><b>Monitor #1</b> -- ASUS MG278Q 1440p 144Hz <a href="https://amzn.to/44yQDz6">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Monitor #2</b> -- BenQ 1080p 144Hz <a href="https://amzn.to/3Yb9qwC">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Monitor #3</b> -- Acer XFA240 1080p 144Hz <a href="https://amzn.to/4iwEaj1">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Keyboard</b> -- Steel Series Apex 7 <a href="https://amzn.to/4jHKC7K">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Mouse</b> -- Steel Series Apex 7 <a href="https://amzn.to/3EySSYP">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Headphones</b> -- HyperX Cloud II <a href="https://amzn.to/3S3LHe4">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Microphone</b> -- Blue Yeti <a href="https://amzn.to/4k2PVir">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Camera</b> -- Logitech Creator StreamCam <a href="https://amzn.to/43XJRmp">[View Item]</a></li>
                    <br>
                    <li class="description-text"><b>Light</b> -- Logitech Litra Glow <a href="https://amzn.to/4jASCHE">[View Item]</a></li>
                    <br>
                </p>

                <h2 class="heading-with-line">FAQ</h2>
                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <div class="chevron-container">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <span>Why OBS and not SLOBS or SE.LIVE?</span>
                        </div>
                        <div class="faq-answer">
                            The reason I choose OBS is because it utilizes less performance compared to the rest. Which means more quality for your setup! SLOBS/SE.LIVE require more CPU usage and can actually HARM the value of your stream or recording setup. I will however use SLOBS widgets and overlays by integrating to OBS!
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            <div class="chevron-container">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <span>What do you mean use OBS with SLOBS integration?</span>
                        </div>
                        <div class="faq-answer">
                            Put simply, I will use SLOBS's many tools to boost OBS's overall quality for a better management and user experience. Things like chatbots, commands, timers, and everything else SLOBS's tools offer! This involves setting them up through menus on SLOBS without explicitly using their program.
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            <div class="chevron-container">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <span>How did I create the graphics?</span>
                        </div>
                        <div class="faq-answer">
                            I love to take inspiration from other things and twitst them into my own unqiue style. Mainly through using ASCII themes, I just can't get enough of that art style!
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            <div class="chevron-container">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <span>What is my experience?</span>
                        </div>
                        <div class="faq-answer">
                            I have surrounded my life around my passion for computers and all their components; software, hardware, applications, and more! Through my own journey I have poured countless hours into configuring my own devices and trying my best to always learn more. As a life-longer learner there is no end!
                        </div>
                    </div>
                    <div class="faq-item">
                        <div class="faq-question">
                            <div class="chevron-container">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <span>Why pick my services over others?</span>
                        </div>
                        <div class="faq-answer">
                            As a streamer myself I understand what it means to have a setup that is new, engaging, and beautiful to attract and retain audiences. With my combined experience of streaming and back-end OBS development I can guarantee great results that cover the entire playing field!
                        </div>
                    </div>
                </div>

                <h2 class="heading-with-line">REVIEWS</h2>
                <div class="reviews-section">
                    {% if product_reviews %}
                        <div class="reviews-list" id="reviewsList">
                            {% for review in product_reviews %}
                            <div class="review-item fade-in">
                                <div class="review-header">
                                    <div class="review-user">
                                        <div class="user-avatar">
                                            {% if review.is_fiverr %}
                                                <div class="avatar-placeholder" style="background: linear-gradient(45deg, #1dbf73, #23e686);">F</div>
                                            {% elif review.order.user.is_staff %}
                                                <div class="private-review-avatar"></div>
                                            {% elif review.order.user.profile_picture and review.order.user.profile_picture.url %}
                                                <img src="{{ review.order.user.profile_picture.url }}" alt="{{ review.order.user.username }}">
                                            {% else %}
                                                <div class="avatar-placeholder">{{ review.order.user.username|first }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="review-user-info">
                                            <div class="username-and-price">
                                                <strong class="username">
                                                    {% if review.is_fiverr %}
                                                        {{ review.fiverr_username }} <span style="font-size: 0.8em; color: #1dbf73;">(Fiverr)</span>
                                                    {% elif review.order.user.is_staff %}
                                                        Private Review
                                                    {% else %}
                                                        {{ review.order.user.username }}
                                                    {% endif %}
                                                </strong>
                                                <span class="order-price">${{ review.order.product.price }}</span>
                                            </div>
                                            <div class="review-rating">
                                                {% for i in "12345" %}
                                                <span class="fa fa-star {% if i|add:'0' <= review.rating %}star-active{% endif %}"></span>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                    {% if review.is_fiverr %}
                                        <a class="review-date" href="https://www.fiverr.com/sebe_tv/stream-setup-and-stream-coaching">View Fiverr</a>
                                    {% else %}
                                        <div class="review-date">{{ review.created_at|date:"F j, Y" }}</div>
                                    {% endif %}
                                </div>
                                <div class="review-content">
                                    <p class="review-comment">{{ review.comment }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        {% if product_reviews.count > 3 %}
                        <div class="review-pagination">
                            <button id="prevReviews" class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i> Previous
                            </button>
                            <div class="pagination-info">
                                <span id="currentPage" style="margin-right: 5px;">1</span> of <span id="totalPages" style="margin-left: 5px;">1</span>
                            </div>
                            <button id="nextReviews" class="pagination-btn">
                                Next <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="no-reviews" style="padding: 1.5rem; margin-bottom: 1.5rem;">
                            <p>No reviews yet for this package. Be the first to leave a review after your purchase!</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div id="lightboxModal" class="lightbox-modal">
        <span class="close-modal">&times;</span>
        <div class="lightbox-content">
            <img id="lightboxImage" src="" alt="Lightbox Image">
            <div class="lightbox-nav">
                <button id="prevButton" class="nav-button"><i class="fas fa-chevron-left"></i></button>
                <button id="nextButton" class="nav-button"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {

        // Full screen featured image
        initLightbox();

        // Global video cache object
        window.videoCache = {};
        
        // Add styling for video elements
        function addVideoStyles() {
            const style = document.createElement('style');
            style.textContent = `
                .video-container {
                    position: relative;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(45deg, #333333, #222222);
                    cursor: pointer;
                }
                
                .video-thumbnail {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    opacity: 1;
                    transition: opacity 0.3s ease;
                }
                
                .placeholder-icon {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 36px;
                    color: rgba(255, 255, 255, 0.5);
                    z-index: 1;
                }
                
                .play-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    background-color: rgba(0, 0, 0, 0.3);
                    transition: background-color 0.3s ease;
                }
                
                .play-button {
                    width: 60px;
                    height: 60px;
                    border-radius: 50%;
                    background-color: rgba(255, 255, 255, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .play-button i {
                    font-size: 24px;
                    color: #333;
                    margin-left: 5px;
                }
                
                .video-container:hover .play-overlay {
                    background-color: rgba(0, 0, 0, 0.2);
                }
                
                .thumbnail.video-thumb {
                    position: relative;
                    background: linear-gradient(45deg, #333333, #222222);
                }
                
                .thumbnail.video-thumb .play-icon {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    color: rgba(255, 255, 255, 0.8);
                    font-size: 1.5rem;
                    z-index: 2;
                }
            `;
            document.head.appendChild(style);
        }
        
        // Setup direct video playback
        function setupDirectVideoPlayback() {
            const featuredContainer = document.getElementById('featured-container');
            const featuredImage = document.getElementById('featuredImage');
            const featuredVideo = document.getElementById('featuredVideo');
            
            // Hide the default video element
            if (featuredVideo) featuredVideo.style.display = 'none';
            
            // Create a simple play button overlay for the image
            const playOverlay = document.createElement('div');
            playOverlay.className = 'play-overlay';
            playOverlay.innerHTML = '<div class="play-button"><i class="fas fa-play"></i></div>';
            
            // Add the play overlay to the container
            featuredContainer.style.position = 'relative';
            featuredContainer.appendChild(playOverlay);
            
            // Direct play handler
            const videoThumb = document.querySelector('.video-thumb');
            if (videoThumb) {
                const videoSrc = videoThumb.dataset.src;
                playOverlay.addEventListener('click', function() {
                    const videoElement = document.createElement('video');
                    videoElement.setAttribute('controls', true);
                    videoElement.setAttribute('playsinline', true);
                    videoElement.setAttribute('autoplay', true);
                    videoElement.className = 'featured-image';
                    
                    featuredContainer.innerHTML = '';
                    featuredContainer.appendChild(videoElement);
                    
                    setTimeout(() => {
                        videoElement.src = videoSrc;
                        videoElement.load();
                        videoElement.play();
                    }, 50);
                });
            }
        }
        
        // Handle gallery thumbnails
        function setupGalleryThumbnails() {
            const thumbnails = document.querySelectorAll('.thumbnail');
            const featuredContainer = document.getElementById('featured-container');

            const inactiveThumbnails = document.querySelectorAll('.thumbnail:not(.active)');
            inactiveThumbnails.forEach(thumb => {
                thumb.style.border = '2px solid #444';
            });
            
            thumbnails.forEach(thumb => {
                thumb.addEventListener('click', function() {
                    // Update active state
                    thumbnails.forEach(t => {
                        t.classList.remove('active');
                        t.style.border = '2px solid #444';
                    });
                    this.classList.add('active');
                    this.style.border = '2px solid #ffffff';
                    
                    if (this.classList.contains('video-thumb')) {
                        // Video thumbnail clicked
                        featuredContainer.innerHTML = '';
                        
                        const videoSrc = this.dataset.src || "{% static 'videos/Bomby_Stream_Setup.mp4' %}";
                        const imageThumb = document.createElement('img');
                        imageThumb.src = "{% static 'images/stream_setup_1.jpg' %}";
                        imageThumb.className = 'featured-image';
                        
                        const playOverlay = document.createElement('div');
                        playOverlay.className = 'play-overlay';
                        playOverlay.innerHTML = '<div class="play-button"><i class="fas fa-play"></i></div>';
                        
                        featuredContainer.style.position = 'relative';
                        featuredContainer.appendChild(imageThumb);
                        featuredContainer.appendChild(playOverlay);
                        
                        playOverlay.addEventListener('click', function() {
                            const videoElement = document.createElement('video');
                            videoElement.setAttribute('controls', true);
                            videoElement.setAttribute('playsinline', true);
                            videoElement.setAttribute('autoplay', true);
                            videoElement.className = 'featured-image';
                            
                            featuredContainer.innerHTML = '';
                            featuredContainer.appendChild(videoElement);
                            
                            setTimeout(() => {
                                videoElement.src = videoSrc;
                                videoElement.load();
                                videoElement.play();
                            }, 50);
                        });
                    } else {
                        // Handle image content
                        const imageElement = document.createElement('img');
                        imageElement.src = this.dataset.image;
                        imageElement.alt = 'Featured image';
                        imageElement.className = 'featured-image';
                        imageElement.id = 'featuredImage';
                        
                        featuredContainer.innerHTML = '';
                        featuredContainer.appendChild(imageElement);
                    }
                });
            });
        }
        
        // FAQ dropdown functionality
        function setupFAQHandlers() {
            const faqItems = document.querySelectorAll('.faq-item');
            
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                
                question.addEventListener('click', function() {
                    // Toggle active class
                    item.classList.toggle('active');
                    
                    // Get the chevron container
                    const chevronContainer = this.querySelector('.chevron-container');
                    
                    // Toggle chevron direction
                    if(item.classList.contains('active')) {
                        chevronContainer.innerHTML = '<i class="fas fa-chevron-down"></i>';
                    } else {
                        chevronContainer.innerHTML = '<i class="fas fa-chevron-right"></i>';
                    }
                });
            });
        }
        
        // Format dates to local timezone
        function setupDateFormatting() {
            const formatLocalDate = (dateString) => {
                if (!dateString) return '';
                try {
                    const date = new Date(dateString);
                    if (isNaN(date.getTime())) {
                        return dateString;
                    }
                    return new Intl.DateTimeFormat('en-US', {
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric'
                    }).format(date);
                } catch (e) {
                    return dateString;
                }
            };
            
            // Convert review dates to local timezone
            document.querySelectorAll('.review-date').forEach(element => {
                if (element.textContent.trim()) {
                    element.textContent = formatLocalDate(element.textContent.trim());
                }
            });
        }
        
        // Handle review pagination
        function setupReviewPagination() {
            const reviewItems = document.querySelectorAll('.review-item');
            if (reviewItems.length > 0) {
                const reviewsList = document.getElementById('reviewsList');
                const reviews = Array.from(reviewItems);
                const reviewsPerPage = 5;
                
                // Shuffle array using Fisher-Yates algorithm
                for (let i = reviews.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [reviews[i], reviews[j]] = [reviews[j], reviews[i]];
                }
                
                // Remove all reviews from DOM
                reviews.forEach(review => review.remove());
                
                // Reappend in new random order
                reviews.forEach(review => {
                    review.style.display = 'none';
                    review.classList.remove('fade-in');
                    reviewsList.appendChild(review);
                });
                
                const totalPages = Math.ceil(reviews.length / reviewsPerPage);
                
                // Set the total pages in pagination info
                const totalPagesElement = document.getElementById('totalPages');
                if (totalPagesElement) {
                    totalPagesElement.textContent = totalPages;
                }
                
                // Show first page of reviews
                reviews.forEach((item, index) => {
                    if (index < reviewsPerPage) {
                        item.style.display = 'block';
                        setTimeout(() => {
                            item.classList.add('fade-in');
                        }, index * 100);
                    }
                });
                
                // Handle pagination
                const prevButton = document.getElementById('prevReviews');
                const nextButton = document.getElementById('nextReviews');
                const currentPageElement = document.getElementById('currentPage');
                
                if (prevButton && nextButton && currentPageElement) {
                    let currentPage = 1;
                    
                    // Disable next button if only one page
                    if (totalPages <= 1) {
                        nextButton.disabled = true;
                    }
                    
                    nextButton.addEventListener('click', function() {
                        if (currentPage < totalPages) {
                            // Hide current page reviews
                            reviews.forEach((item, index) => {
                                const startIndex = (currentPage - 1) * reviewsPerPage;
                                const endIndex = startIndex + reviewsPerPage - 1;
                                
                                if (index >= startIndex && index <= endIndex) {
                                    item.classList.remove('fade-in');
                                    setTimeout(() => {
                                        item.style.display = 'none';
                                    }, 300);
                                }
                            });
                            
                            // Increment page and update UI
                            currentPage++;
                            currentPageElement.textContent = currentPage;
                            prevButton.disabled = false;
                            
                            // Show new page reviews
                            setTimeout(() => {
                                reviews.forEach((item, index) => {
                                    const startIndex = (currentPage - 1) * reviewsPerPage;
                                    const endIndex = startIndex + reviewsPerPage - 1;
                                    
                                    if (index >= startIndex && index <= endIndex) {
                                        item.style.display = 'block';
                                        setTimeout(() => {
                                            item.classList.add('fade-in');
                                        }, 50);
                                    }
                                });
                            }, 300);
                            
                            // Disable next button if last page
                            if (currentPage >= totalPages) {
                                nextButton.disabled = true;
                            }
                        }
                    });
                    
                    prevButton.addEventListener('click', function() {
                        if (currentPage > 1) {
                            // Hide current page reviews
                            reviews.forEach((item, index) => {
                                const startIndex = (currentPage - 1) * reviewsPerPage;
                                const endIndex = startIndex + reviewsPerPage - 1;
                                
                                if (index >= startIndex && index <= endIndex) {
                                    item.classList.remove('fade-in');
                                    setTimeout(() => {
                                        item.style.display = 'none';
                                    }, 300);
                                }
                            });
                            
                            // Decrement page and update UI
                            currentPage--;
                            currentPageElement.textContent = currentPage;
                            nextButton.disabled = false;
                            
                            // Show new page reviews
                            setTimeout(() => {
                                reviews.forEach((item, index) => {
                                    const startIndex = (currentPage - 1) * reviewsPerPage;
                                    const endIndex = startIndex + reviewsPerPage - 1;
                                    
                                    if (index >= startIndex && index <= endIndex) {
                                        item.style.display = 'block';
                                        setTimeout(() => {
                                            item.classList.add('fade-in');
                                        }, 50);
                                    }
                                });
                            }, 300);
                            
                            // Disable prev button if first page
                            if (currentPage <= 1) {
                                prevButton.disabled = true;
                            }
                        }
                    });
                }
            }
        }
        
        // Initialize everything
        function init() {
            // Add default styling
            addVideoStyles();
            
            // Set up direct video playback first
            setupDirectVideoPlayback();
            
            // Set up all event handlers
            setupGalleryThumbnails();
            setupFAQHandlers();
            setupDateFormatting();
            setupReviewPagination();
        }
        
        // Run initialization
        init();

        function initLightbox() {
            const modal = document.getElementById('lightboxModal');
            const modalImg = document.getElementById('lightboxImage');
            const closeBtn = document.querySelector('.close-modal');
            const prevBtn = document.getElementById('prevButton');
            const nextBtn = document.getElementById('nextButton');
            const thumbnails = document.querySelectorAll('.thumbnail:not(.video-thumb)');
            
            // Current image index
            let currentIndex = 0;
            
            // Get all image sources from thumbnails (excluding video thumbnails)
            const imageSources = Array.from(thumbnails)
                .filter(thumb => thumb.dataset.image)
                .map(thumb => thumb.dataset.image);
            
            // Function to open lightbox
            function openLightbox(imageSrc) {
                modal.style.display = 'block';
                modalImg.src = imageSrc;
                
                // Find the current index
                currentIndex = imageSources.indexOf(imageSrc);
                if (currentIndex === -1) currentIndex = 0;
                
                // Disable scrolling on body
                document.body.style.overflow = 'hidden';
            }
            
            // Add click handlers to all image thumbnails
            thumbnails.forEach(thumb => {
                if (thumb.dataset.image) {
                    thumb.addEventListener('click', function() {
                    });
                }
            });
            
            // Open lightbox when clicking on featured image
            document.addEventListener('click', function(e) {
                // Check if the clicked element is the featured image
                if (e.target.classList.contains('featured-image') && 
                    e.target.tagName === 'IMG' &&
                    !e.target.closest('.thumbnail')) {
                    openLightbox(e.target.src);
                }
            });
            
            // Close the lightbox
            closeBtn.addEventListener('click', function() {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
            
            // Close on click outside the image
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
            
            // Previous image
            prevBtn.addEventListener('click', function() {
                if (imageSources.length > 0) {
                    currentIndex = (currentIndex - 1 + imageSources.length) % imageSources.length;
                    modalImg.src = imageSources[currentIndex];
                }
            });
            
            // Next image
            nextBtn.addEventListener('click', function() {
                if (imageSources.length > 0) {
                    currentIndex = (currentIndex + 1) % imageSources.length;
                    modalImg.src = imageSources[currentIndex];
                }
            });
            
            // Keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (modal.style.display === 'block') {
                    if (e.key === 'ArrowLeft') {
                        prevBtn.click();
                    } else if (e.key === 'ArrowRight') {
                        nextBtn.click();
                    } else if (e.key === 'Escape') {
                        closeBtn.click();
                    }
                }
            });
        }
    });
</script>
{% endblock %}